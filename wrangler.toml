name = "url-shortener"
type = "rust"
main = "build/worker/shim.mjs"
compatibility_date = "2024-01-01"

[build]
command = "cargo install -q worker-build && worker-build --release"

[build.upload]
format = "modules"
main = "./build/worker/shim.mjs"

[[build.upload.rules]]
type = "CompiledWasm"
globs = ["**/*.wasm"]

# KV namespace for storing URLs
[[kv_namespaces]]
binding = "URLS"
id = "2a1b39d9cb9e4c2a9ca27e385c74a97a"

# D1 database for analytics and users
[[d1_databases]]
binding = "DB"
database_name = "url_shortener_db"
database_id = "526b28e5-8896-42e7-a211-135355521e48"

# Environment variables
[vars]
BASE_URL = "https://url-shortener.blatik-short.workers.dev"
JWT_SECRET = "change-this-to-random-secret-key-here"

# Secrets (set with: wrangler secret put STRIPE_SECRET_KEY)
# STRIPE_SECRET_KEY
# STRIPE_WEBHOOK_SECRET
